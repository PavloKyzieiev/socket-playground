(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{12:function(e,t,n){e.exports=n(27)},18:function(e,t,n){},27:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),c=n(5),r=n.n(c),s=(n(18),n(2)),l=n(1),u=n(3),i=n(6),m=n(7),d=n(10),h=n(8),g=n(11),b=n(9),f=n.n(b),k=function(e){function t(){var e,n;Object(i.a)(this,t);for(var a=arguments.length,o=new Array(a),c=0;c<a;c++)o[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(o)))).state={storageUrl:localStorage.getItem("storageUrl")||"",authToken:f.a.parse(window.location.search).user||localStorage.getItem("authToken")||"",authorized:!1,loading:!1,socket:null,consoleData:[],instruments:[],activeInstrument:null},n.handleInputChange=function(e,t){var a=e.target.value;localStorage.setItem(t,a),n.setState(Object(u.a)({},t,a))},n.handleConnectButtonClick=function(){var e=n.state,t=e.authorized,a=e.storageUrl,o=n.state.socket;if(t)o&&t&&(n.setState({instruments:[],activeInstrument:null}),o.close());else{try{o=new WebSocket(a)}catch(c){return n.setState({consoleData:[c.message]})}n.setState({socket:o,loading:!0})}},n.initWebSocket=function(){var e=n.state,t=e.socket,a=e.authToken;t.onopen=function(){n.setState(function(e){return Object(l.a)({},e,{consoleData:[].concat(Object(s.a)(e.consoleData),["\u0421\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043e."])})}),t.send(JSON.stringify({name:"auth",authToken:a}))},t.onclose=function(e){var t="";t=e.wasClean?"\u0421\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u0437\u0430\u043a\u0440\u044b\u0442\u043e":"\u041e\u0431\u0440\u044b\u0432 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f",n.setState(function(e){return Object(l.a)({},e,{consoleData:[].concat(Object(s.a)(e.consoleData),[t]),authorized:!1,socket:null,loading:!1,order:null})})},t.onmessage=function(e){var a=JSON.parse(e.data),o=a.name,c=a.status,r=a.instruments,u=a.order,i=n.state.authorized;switch(o){case"authRequest":"OK"===c?(i=!0,t.send(JSON.stringify({name:"instruments"}))):i=!1;break;case"instruments":"OK"===c&&n.setState(function(e){return Object(l.a)({},e,{instruments:r})});break;case"order":"OK"===c&&n.setState(function(e){return Object(l.a)({},e,{order:u})})}i||(t=null),n.setState(function(n){return Object(l.a)({},n,{consoleData:[].concat(Object(s.a)(n.consoleData),[e.data]),authorized:i,loading:!1,socket:t})})},t.onerror=function(e){n.setState(function(t){return Object(l.a)({},t,{consoleData:[].concat(Object(s.a)(t.consoleData),["\u041e\u0448\u0438\u0431\u043a\u0430 "+e.message]),authorized:!1,socket:null,loading:!1})})}},n.subscribe=function(e){var t=n.state,a=t.socket;t.activeInstrument!==e&&(a.send(JSON.stringify({name:"subscribe",brokerId:e})),n.setState({activeInstrument:e}))},n}return Object(g.a)(t,e),Object(m.a)(t,[{key:"componentDidUpdate",value:function(e,t){!t.socket&&this.state.socket&&this.initWebSocket()}},{key:"render",value:function(){var e=this,t=this.state,n=t.authorized,a=t.consoleData,c=t.loading,r=t.instruments,s=t.activeInstrument,l=c?o.a.createElement("span",null,"Loading"):o.a.createElement("button",{type:"button",onClick:this.handleConnectButtonClick},n?"Disconnect":"Connect");return o.a.createElement("div",null,o.a.createElement("div",{className:"form-group"},o.a.createElement("label",null,"\u0415\u043d\u0434\u043f\u043e\u0438\u043d\u0442 (ws[s]://...)"),o.a.createElement("input",{value:this.state.storageUrl,onChange:function(t){return e.handleInputChange(t,"storageUrl")}})),o.a.createElement("div",{className:"form-group"},o.a.createElement("label",null,"\u0422\u043e\u043a\u0435\u043d"),o.a.createElement("input",{value:this.state.authToken,onChange:function(t){return e.handleInputChange(t,"authToken")}})),l,r.length?o.a.createElement("div",{className:"instruments"},r.map(function(t,n){return o.a.createElement("button",{key:n,className:s===t.id?"active":"",onClick:function(){return e.subscribe(t.id)}},t.name)})):null,a.length?o.a.createElement("div",{className:"console-wrap"},o.a.createElement("button",{onClick:function(){return e.setState({consoleData:[]})}},"Clear"),a.map(function(e,t){return o.a.createElement("p",{className:"console",key:t},e)})):null)}}]),t}(o.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(o.a.createElement(k,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[12,2,1]]]);
//# sourceMappingURL=main.06cd3e92.chunk.js.map