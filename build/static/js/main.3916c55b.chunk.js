(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{20:function(e,t){var n=t.Quote={};n.read=function(e,t){return e.readFields(n._readField,{rec:null,instrumentId:"",bid:"",ask:"",time:0},t)},n._readField=function(e,t,n){1===e?t.rec=r.read(n,n.readVarint()+n.pos):2===e?t.instrumentId=n.readString():3===e?t.bid=n.readString():4===e?t.ask=n.readString():5===e&&(t.time=n.readVarint(!0))},n.write=function(e,t){e.rec&&t.writeMessage(1,r.write,e.rec),e.instrumentId&&t.writeStringField(2,e.instrumentId),e.bid&&t.writeStringField(3,e.bid),e.ask&&t.writeStringField(4,e.ask),e.time&&t.writeVarintField(5,e.time)};var r=t.Recipient={};r.read=function(e,t){return e.readFields(r._readField,{brokerId:0,accountId:0},t)},r._readField=function(e,t,n){1===e?t.brokerId=n.readVarint(!0):2===e&&(t.accountId=n.readVarint(!0))},r.write=function(e,t){e.brokerId&&t.writeVarintField(1,e.brokerId),e.accountId&&t.writeVarintField(2,e.accountId)}},24:function(e,t,n){e.exports=n(39)},29:function(e,t,n){},39:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),c=n(13),s=n.n(c),i=(n(29),n(7)),o=n.n(i),l=n(14),u=n(6),d=n(15),m=n(16),h=n(22),g=n(17),f=n(23),p=function(e){var t=e.sub,n=t.instrumentId,r=t.bid,c=t.ask,s=t.time;return a.a.createElement("div",{className:"trading"},a.a.createElement("ul",null,a.a.createElement("li",null,a.a.createElement("b",null,"instrument:")," ",n),a.a.createElement("li",null,a.a.createElement("b",null,"bid:")," ",r,", ",a.a.createElement("b",null,"ask:")," ",c),a.a.createElement("li",null,a.a.createElement("b",null,"time:")," ",s)))},E=function(e){var t=e.start,n=e.inputChange,r=e.enabled,c=e.perSecond,s=e.seconds;return a.a.createElement("div",{className:"stress"},!r&&a.a.createElement("button",{onClick:t},"Stress"),a.a.createElement("input",{onChange:function(e){return n(e,"perSecond")},value:c,type:"number"})," ","per. sec.",a.a.createElement("input",{onChange:function(e){return n(e,"seconds")},value:s,type:"number"})," ","repeat sec")},b=n(4),k=Object(b.b)(function(e){return{subscriptions:e.market.subscriptions,instruments:e.market.instruments}})(function(e){var t=e.instruments,n=e.subscriptions,r=e.handleClick;return a.a.createElement("div",{className:"instruments"},t.map(function(e,t){return a.a.createElement("button",{className:n[e.sym]&&"active",key:t,onClick:function(){return r(e.sym)}},e.sym)}))}),v=function(e){var t=e.label,n=e.value,r=e.changeHangler;return a.a.createElement("div",{className:"form-group"},a.a.createElement("label",null,t),a.a.createElement("input",{value:n,onChange:r}))},S=n(19),w=n.n(S),I=n(20),y=n(1);function C(e){var t=Object(y.a)({},e);for(var n in t){var r=t[n];"object"===typeof r&&null!==r&&(r=C(r))}return t}var O="USER_CONNECT_START",N="USER_CONNECT_SUCCESS",T="USER_CONNECT_ERROR",j="FETCH_INSTRUMENTS_START",F="FETCH_INSTRUMENTS_SUCCESS",R="SET_ORDERS",_="SET_SUBSCRIPTIONS";var U={instrumentId:0,bid:0,ask:0,time:0};function V(e,t){return function(n,r){var a=r().socket.socket;n({type:j}),a.send(JSON.stringify({type:2,rec:{b:e,a:t}}))}}function x(e){return{type:_,subscriptions:e}}function H(e){return function(t,n){t({type:O});var r=new WebSocket(e);r.binaryType="arraybuffer",r.onerror=function(e){t(function(e){return{type:T,error:e}}(e))},r.onopen=function(){t(function(e){return{type:N,socket:e}}(r))},r.onmessage=function(e){var r,a,c=n().market,s=c.subscriptions,i=c.orders,o=null,l=null,u=null;if("string"!==typeof e.data){var d=new w.a(e.data),m=r=I.Quote.read(d),h=m.instrumentId,g=m.bid,f=m.ask,p=m.time,E=(u=C(s))[h];E?(E.instrumentId=h,E.bid=g,E.ask=f,E.time=p):(o=C(i))[h]={instrumentId:h,bid:g,ask:f,time:p}}else r=JSON.parse(e.data);switch(r.type){case 7:return t((a=r.instruments,{type:F,instruments:a}));case 10:l={},r.s.sub[0].sym.forEach(function(e){o||(o=C(i)),delete o[e],s[e]?(u||(u=C(s)),l[e]=u[e]):l[e]={instrumentId:e}})}l&&t(x(l)),o&&t(function(e){return{type:R,orders:e}}(o))}}}window.limits={perSecond:200,seconds:60};var M=function(e){function t(){var e,n;Object(d.a)(this,t);for(var r=arguments.length,a=new Array(r),c=0;c<r;c++)a[c]=arguments[c];return(n=Object(h.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(a)))).state={storageUrl:localStorage.getItem("storageUrl")||"",userId:localStorage.getItem("userId")||"",broker:localStorage.getItem("broker")||"",account:localStorage.getItem("account")||"",perSecond:localStorage.getItem("perSecond")||10,seconds:localStorage.getItem("seconds")||1,stressEnabled:!1},n.handleInputChange=function(e,t){var r=e.target.value;"perSecond"===t&&r>window.limits.perSecond&&(r=window.limits.perSecond),"seconds"===t&&r>window.limits.seconds&&(r=window.limits.seconds),localStorage.setItem(t,r),n.setState(Object(u.a)({},t,r))},n.handleConnectButtonClick=function(){var e=n.state,t=e.storageUrl,r=e.userId;n.props.initWebSocket(t.split("?")[0]+"?user="+r)},n.request=function(e){n.state.socket.send(e)},n.handleInstrumentClick=function(e){var t=n.state,r=t.broker,a=t.account;n.props.setInstrument(e,r,a)},n.getInstruments=function(){var e=n.state,t=e.broker,r=e.account;n.props.fetchInstruments(t,r)},n.handleStressTest=Object(l.a)(o.a.mark(function e(){var t,r,a,c,s,i,l,u;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=n.state,r=t.seconds,a=t.perSecond,c=n.props.instruments,n.setState({stressEnabled:!0}),s=function(e){return new Promise(function(t,r){n.handleInstrumentClick(e),setTimeout(t,Math.floor(1e3/+a))})},i=0;case 5:if(!(i<+r)){e.next=17;break}l=0;case 7:if(!(l<+a)){e.next=14;break}return u=Math.floor(Math.random()*c.length),e.next=11,s(c[u].sym);case 11:l++,e.next=7;break;case 14:i++,e.next=5;break;case 17:n.setState({stressEnabled:!1});case 18:case"end":return e.stop()}},e,this)})),n}return Object(f.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this,t=this.state,n=t.perSecond,r=t.seconds,c=t.stressEnabled,s=this.props,i=s.authorized,o=s.loading,l=s.instruments,u=s.subscriptions,d=s.orders;return a.a.createElement("div",null,a.a.createElement("div",{className:"control"},a.a.createElement(a.a.Fragment,null,a.a.createElement(v,{label:"\u0415\u043d\u0434\u043f\u043e\u0438\u043d\u0442 (ws[s]://...)",value:this.state.storageUrl,changeHangler:function(t){return e.handleInputChange(t,"storageUrl")}}),a.a.createElement(v,{label:"\u042e\u0437\u0435\u0440",value:this.state.userId,changeHangler:function(t){return e.handleInputChange(t,"userId")}})),i&&a.a.createElement(a.a.Fragment,null,a.a.createElement(v,{label:"\u0411\u0440\u043e\u043a\u0435\u0440",value:this.state.broker,changeHangler:function(t){return e.handleInputChange(t,"broker")}}),a.a.createElement(v,{label:"\u0410\u043a\u043a\u0430\u0443\u043d\u0442",value:this.state.account,changeHangler:function(t){return e.handleInputChange(t,"account")}})),o?a.a.createElement("span",null,"Loading"):!i&&a.a.createElement("button",{type:"button",onClick:this.handleConnectButtonClick},"Connect")),i&&a.a.createElement("div",null,a.a.createElement("button",{onClick:this.getInstruments},"Get Instruments"),l.length>0?a.a.createElement(E,{enabled:c,inputChange:this.handleInputChange,perSecond:n,seconds:r,start:this.handleStressTest}):null),a.a.createElement(k,{handleClick:this.handleInstrumentClick}),a.a.createElement("hr",null),i&&a.a.createElement("div",{className:"body_wrap"},a.a.createElement("div",{className:"trading_wrap"},a.a.createElement("div",{className:"tr_item"},a.a.createElement("h2",null,"Subscriptions:"),Object.keys(u).map(function(e){return a.a.createElement(p,{key:e,sub:u[e]})})),a.a.createElement("div",{className:"tr_item orders"},a.a.createElement("h2",null,"Orders:"),Object.keys(d).map(function(e){return a.a.createElement(p,{key:e,sub:d[e]})})))))}}]),t}(a.a.Component),z=Object(b.b)(function(e){return{loading:e.socket.loading,authorized:e.socket.authorized,instruments:e.market.instruments,orders:e.market.orders,subscriptions:e.market.subscriptions}},function(e){return{initWebSocket:function(t){return e(H(t))},fetchInstruments:function(t,n){return e(V(t,n))},setInstrument:function(t){return e(function(e,t,n){return function(r,a){var c,s=a(),i=s.market.subscriptions,o=s.socket.socket,l=C(i),u=[];l[e]?delete l[e]:(l[e]=Object(y.a)({},U),l[e].instrumentId=e),Object.keys(l).forEach(function(e){return u.push(e)}),r(x(l)),c=function(e){for(var t=5381,n=e.length;n;)t=33*t^e.charCodeAt(--n);return t>>>0}(t+"&"+n+"&"+u),o.send(JSON.stringify({type:1,s:{sub:[{rec:{b:t,a:n},sym:u}],hash:c}}))}}(t))}}})(M);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var B=n(2),J=n(21),W={authorized:!1,loading:!1,socket:null,error:null},A={loading:!1,instruments:[],orders:{},subscriptions:{}},D=Object(B.c)({socket:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:W,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case O:return Object(y.a)({},e,{loading:!0});case N:return Object(y.a)({},e,{loading:!1,authorized:!0,socket:t.socket});case T:return Object(y.a)({},e,{loading:!1,error:t.error});default:return e}},market:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case _:return Object(y.a)({},e,{subscriptions:t.subscriptions});case j:return Object(y.a)({},e,{loading:!0});case F:return Object(y.a)({},e,{instruments:t.instruments,loading:!1});case R:return Object(y.a)({},e,{orders:t.orders});default:return e}}}),P=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||B.d,L=Object(B.e)(D,P(Object(B.a)(J.a)));s.a.render(a.a.createElement(b.a,{store:L},a.a.createElement(z,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[24,2,1]]]);
//# sourceMappingURL=main.3916c55b.chunk.js.map