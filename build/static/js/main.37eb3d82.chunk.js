(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{11:function(e,t){var n=t.Quote={};n.read=function(e,t){return e.readFields(n._readField,{rec:null,instrumentId:"",bid:"",ask:"",time:0},t)},n._readField=function(e,t,n){1===e?t.rec=a.read(n,n.readVarint()+n.pos):2===e?t.instrumentId=n.readString():3===e?t.bid=n.readString():4===e?t.ask=n.readString():5===e&&(t.time=n.readVarint(!0))},n.write=function(e,t){e.rec&&t.writeMessage(1,a.write,e.rec),e.instrumentId&&t.writeStringField(2,e.instrumentId),e.bid&&t.writeStringField(3,e.bid),e.ask&&t.writeStringField(4,e.ask),e.time&&t.writeVarintField(5,e.time)};var a=t.Recipient={};a.read=function(e,t){return e.readFields(a._readField,{brokerId:0,accountId:0},t)},a._readField=function(e,t,n){1===e?t.brokerId=n.readVarint(!0):2===e&&(t.accountId=n.readVarint(!0))},a.write=function(e,t){e.brokerId&&t.writeVarintField(1,e.brokerId),e.accountId&&t.writeVarintField(2,e.accountId)}},14:function(e,t,n){e.exports=n(26)},20:function(e,t,n){},26:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),s=n(6),i=n.n(s),c=(n(20),n(1)),o=n.n(c),l=n(3),u=n(4),d=n(2),m=n(7),b=n(8),p=n(12),g=n(9),h=n(13),f=n(10),k=n.n(f),E=n(11),v=function(e){var t=e.sub,n=t.instrumentId,a=t.bid,s=t.ask,i=t.time;return r.a.createElement("div",{className:"trading"},r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("b",null,"instrument:")," ",n),r.a.createElement("li",null,r.a.createElement("b",null,"bid:")," ",a,", ",r.a.createElement("b",null,"ask:")," ",s),r.a.createElement("li",null,r.a.createElement("b",null,"time:")," ",i)))},w=function(e){var t=e.start,n=e.inputChange,a=e.enabled,s=e.perSecond,i=e.seconds;return r.a.createElement("div",{className:"stress"},!a&&r.a.createElement("button",{onClick:t},"Stress"),r.a.createElement("input",{onChange:function(e){return n(e,"perSecond")},value:s,type:"number"})," ","per. sec.",r.a.createElement("input",{onChange:function(e){return n(e,"seconds")},value:i,type:"number"})," ","repeat sec")};window.limits={perSecond:200,seconds:60};var I={instrumentId:0,bid:0,ask:0,time:0},S=function(e){function t(){var e,n;Object(m.a)(this,t);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(n=Object(p.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(r)))).state={storageUrl:localStorage.getItem("storageUrl")||"",userId:localStorage.getItem("userId")||"",broker:localStorage.getItem("broker")||"",account:localStorage.getItem("account")||"",perSecond:localStorage.getItem("perSecond")||10,seconds:localStorage.getItem("seconds")||1,authorized:!1,loading:!1,socket:null,instruments:[],subscriptions:{},orders:{},stressEnabled:!1},n.handleInputChange=function(e,t){var a=e.target.value;"perSecond"===t&&a>window.limits.perSecond&&(a=window.limits.perSecond),"seconds"===t&&a>window.limits.seconds&&(a=window.limits.seconds),localStorage.setItem(t,a),n.setState(Object(d.a)({},t,a))},n.handleConnectButtonClick=function(){var e=n.state,t=e.authorized,a=e.storageUrl,r=e.userId,s=n.state.socket;if(t)s&&t&&(n.setState({instruments:[],socket:null}),s.close());else{try{(s=new WebSocket(a.split("?")[0]+"?user="+r)).binaryType="arraybuffer"}catch(i){throw new Error(i)}n.setState({socket:s,loading:!0})}},n.initWebSocket=function(){var e=n.state.socket;e.onopen=function(){n.setState({authorized:!0})},e.onmessage=function(){var e=Object(u.a)(o.a.mark(function e(t){var a,r,s,i,c,u,d,m,b,p,g,h,f,v;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.state,s=r.instruments,i=r.subscriptions,c=r.orders,"1"!==t.data){e.next=3;break}return e.abrupt("return",console.timeEnd("Ping-Pong"));case 3:"string"!==typeof t.data?(u=new k.a(t.data),a=E.Quote.read(u),m=(d=a).instrumentId,b=d.bid,p=d.ask,g=d.time,(h=i[m])?(h.instrumentId=m,h.bid=b,h.ask=p,h.time=g):c[m]={instrumentId:m,bid:b,ask:p,time:g}):a=JSON.parse(t.data),f=a.type,v=null,e.t0=f,e.next=7===e.t0?9:10===e.t0?11:14;break;case 9:return s=a.instruments,e.abrupt("break",15);case 11:return v={},a.s.sub[0].sym.forEach(function(e){delete c[e],i[e]?v[e]=i[e]:v[e]={instrumentId:e}}),e.abrupt("break",15);case 14:return e.abrupt("break",15);case 15:n.setState(function(e){return Object(l.a)({},e,{loading:!1,instruments:s,subscriptions:v||i,orders:c})});case 16:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),e.onerror=function(e){console.log(e)},e.onclose=function(){n.setState({authorized:!1,socket:null,subscriptions:{}})}},n.request=function(e){n.state.socket.send(e)},n.handleInstrumentClick=function(e){var t,a=e.sym,r=n.state,s=r.broker,i=r.account,c=r.subscriptions,o=Object(l.a)({},c),u=[];o[a]?delete o[a]:o[a]=Object(l.a)({},I),Object.keys(o).forEach(function(e){return u.push(e)}),n.setState({subscriptions:o}),t=function(e){var t=5381,n=e.length;for(;n;)t=33*t^e.charCodeAt(--n);return t>>>0}(s+"&"+i+"&"+u),n.request(JSON.stringify({type:1,s:{sub:[{rec:{b:s,a:i},sym:u}],hash:t}}))},n.getInstruments=function(){var e=n.state,t=e.broker,a=e.account;e.socket.send(JSON.stringify({type:2,rec:{b:t,a:a}}))},n.pingPong=function(){var e=n.state.socket;console.time("Ping-Pong"),e.send("0")},n.handleStressTest=Object(u.a)(o.a.mark(function e(){var t,a,r,s,i,c,l;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=n.state,a=t.perSecond,r=t.seconds,s=t.instruments,n.setState({stressEnabled:!0}),i=function(e){return new Promise(function(t,r){n.handleInstrumentClick({sym:e}),setTimeout(t,Math.floor(1e3/+a))})},c=0;case 4:if(!(c<+r)){e.next=15;break}l=0;case 6:if(!(l<+a)){e.next=12;break}return e.next=9,i(y(s));case 9:l++,e.next=6;break;case 12:c++,e.next=4;break;case 15:n.setState({stressEnabled:!1});case 16:case"end":return e.stop()}},e,this)})),n}return Object(h.a)(t,e),Object(b.a)(t,[{key:"componentDidUpdate",value:function(e,t){!t.socket&&this.state.socket&&this.initWebSocket()}},{key:"render",value:function(){var e=this,t=this.state,n=t.authorized,a=t.loading,s=t.instruments,i=t.subscriptions,c=t.orders,o=t.perSecond,l=t.seconds,u=t.stressEnabled,d=a?r.a.createElement("span",null,"Loading"):r.a.createElement("button",{type:"button",onClick:this.handleConnectButtonClick},n?"Disconnect":"Connect");return r.a.createElement("div",null,r.a.createElement("div",{className:"control"},r.a.createElement("div",null,r.a.createElement("div",{className:"form-group"},r.a.createElement("label",null,"\u0415\u043d\u0434\u043f\u043e\u0438\u043d\u0442 (ws[s]://...)"),r.a.createElement("input",{value:this.state.storageUrl,onChange:function(t){return e.handleInputChange(t,"storageUrl")}})),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",null,"\u042e\u0437\u0435\u0440"),r.a.createElement("input",{value:this.state.userId,onChange:function(t){return e.handleInputChange(t,"userId")}}))),n&&r.a.createElement("div",null,r.a.createElement("div",{className:"form-group"},r.a.createElement("label",null,"\u0411\u0440\u043e\u043a\u0435\u0440"),r.a.createElement("input",{value:this.state.broker,onChange:function(t){return e.handleInputChange(t,"broker")}})),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",null,"\u0410\u043a\u043a\u0430\u0443\u043d\u0442"),r.a.createElement("input",{value:this.state.account,onChange:function(t){return e.handleInputChange(t,"account")}}))),d),n&&r.a.createElement("div",null,r.a.createElement("button",{onClick:this.getInstruments},"Get Instruments"),r.a.createElement("button",{onClick:this.pingPong},"Ping-Pong"),r.a.createElement(w,{enabled:u,inputChange:this.handleInputChange,perSecond:o,seconds:l,start:this.handleStressTest})),r.a.createElement("div",{className:"instruments"},s.map(function(t,n){return r.a.createElement("button",{className:i[t.sym]&&"active",key:n,onClick:function(){return e.handleInstrumentClick({sym:t.sym})}},t.sym)})),r.a.createElement("hr",null),n&&r.a.createElement("div",{className:"body_wrap"},r.a.createElement("div",{className:"trading_wrap"},r.a.createElement("div",{className:"tr_item"},r.a.createElement("h2",null,"Subscriptions:"),Object.keys(i).map(function(e){return r.a.createElement(v,{key:e,sub:i[e]})})),r.a.createElement("div",{className:"tr_item orders"},r.a.createElement("h2",null,"Orders:"),Object.keys(c).map(function(e){return r.a.createElement(v,{key:e,sub:c[e]})})))))}}]),t}(r.a.Component),y=function(e){var t=Object.keys(e);return t[t.length*Math.random()<<0]};var C=S;Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(C,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[14,2,1]]]);
//# sourceMappingURL=main.37eb3d82.chunk.js.map