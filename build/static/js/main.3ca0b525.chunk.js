(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{40:function(e,t,n){e.exports=n(67)},45:function(e,t,n){},67:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(32),l=n.n(o),s=(n(45),n(19)),u=n.n(s),c=n(33),i=n(5),m=n(10),d=n(34),b=n(35),p=n(38),k=n(36),g=n(39),h=n(37),f=n.n(h),v={instrumentId:null,bid:null,ask:null,time:null},E=function(e){function t(){var e,n;Object(d.a)(this,t);for(var a=arguments.length,o=new Array(a),l=0;l<a;l++)o[l]=arguments[l];return(n=Object(p.a)(this,(e=Object(k.a)(t)).call.apply(e,[this].concat(o)))).state={storageUrl:localStorage.getItem("storageUrl")||"",userId:localStorage.getItem("userId")||"",broker:localStorage.getItem("broker")||"",account:localStorage.getItem("account")||"",authorized:!1,loading:!1,socket:null,protoQuotes:null,instruments:[],consoleContainer:r.a.createRef(),markets:{},selectedInstruments:[]},n.handleInputChange=function(e,t){var a=e.target.value;localStorage.setItem(t,a),n.setState(Object(m.a)({},t,a))},n.handleConnectButtonClick=function(){var e=n.state,t=e.authorized,a=e.storageUrl,r=e.userId,o=n.state.socket;if(t)o&&t&&(n.setState({instruments:[],activeInstrument:null}),o.close());else{try{(o=new WebSocket(a.split("?")[0]+"?user="+r)).binaryType="arraybuffer"}catch(l){throw new Error(l)}n.setState({socket:o,loading:!0})}},n.initWebSocket=function(){var e=n.state,t=e.socket,a=e.userId;t.onopen=function(){n.request(JSON.stringify({user:{userId:a}}))},t.onclose=function(e){n.setState(function(e){return Object(i.a)({},e,{authorized:!1,socket:null,loading:!1,order:null})})},t.onmessage=function(){var e=Object(c.a)(u.a.mark(function e(a){var r,o,l,s,c,m,d,b,p,k,g,h,f,v;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:console.time("time from getting data to render"),o=n.state,l=o.authorized,s=o.protoQuotes,c=o.instruments,m=o.currentMarket,d=o.markets,"string"!==typeof a.data?(b=new Uint8Array(a.data),r=s.decode(b),d[r.instrumentId]&&(k=(p=r).instrumentId,g=p.bid,h=p.ask,f=p.time,d[r.instrumentId].instrumentId=k,d[r.instrumentId].bid=g,d[r.instrumentId].ask=h,d[r.instrumentId].time=f)):r=JSON.parse(a.data),v=r.type,e.t0=v,e.next=0===e.t0?7:1===e.t0?9:7===e.t0?11:13;break;case 7:return l=!0,e.abrupt("break",14);case 9:return l=!1,e.abrupt("break",14);case 11:return c=r.instruments,e.abrupt("break",14);case 13:return e.abrupt("break",14);case 14:l||(t=null),n.setState(function(e){return Object(i.a)({},e,{authorized:l,loading:!1,socket:t,instruments:c,currentMarket:m,markets:d})});case 16:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),t.onerror=function(e){n.setState(function(e){return Object(i.a)({},e,{authorized:!1,socket:null,loading:!1})})}},n.request=function(e){n.state.socket.send(e)},n.handleInstrumentClick=function(e){var t=e.sym,a=n.state,r=a.broker,o=a.account,l=a.markets,s=Object(i.a)({},l),u=[];s[t]?delete s[t]:s[t]=Object(i.a)({},v),Object.keys(s).forEach(function(e){return u.push(e)}),n.setState({markets:s}),n.request(JSON.stringify({type:1,sub:[{rec:{brk:r,acc:o},sym:u}]}))},n.getInstruments=function(){var e=n.state,t=e.broker,a=e.account;e.socket.send(JSON.stringify({type:2,rec:{brk:t,acc:a}}))},n}return Object(g.a)(t,e),Object(b.a)(t,[{key:"componentDidUpdate",value:function(e,t){console.timeEnd("time from getting data to render");var n=this.state.consoleContainer;n.current&&(n.current.scrollTop=n.current.scrollHeight),!t.socket&&this.state.socket&&this.initWebSocket()}},{key:"componentDidMount",value:function(){var e=this;f.a.load("proto/awesome.proto").then(function(t){var n=t.lookupType("protobuf.quotes.Quote");e.setState(function(e){return Object(i.a)({},e,{protoQuotes:n})})})}},{key:"render",value:function(){var e=this,t=this.state,n=t.authorized,a=t.loading,o=t.instruments,l=t.markets,s=a?r.a.createElement("span",null,"Loading"):r.a.createElement("button",{type:"button",onClick:this.handleConnectButtonClick},n?"Disconnect":"Connect");return r.a.createElement("div",null,r.a.createElement("div",{className:"control"},r.a.createElement("div",null,r.a.createElement("div",{className:"form-group"},r.a.createElement("label",null,"\u0415\u043d\u0434\u043f\u043e\u0438\u043d\u0442 (ws[s]://...)"),r.a.createElement("input",{value:this.state.storageUrl,onChange:function(t){return e.handleInputChange(t,"storageUrl")}})),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",null,"\u042e\u0437\u0435\u0440"),r.a.createElement("input",{value:this.state.userId,onChange:function(t){return e.handleInputChange(t,"userId")}}))),n&&r.a.createElement("div",null,r.a.createElement("div",{className:"form-group"},r.a.createElement("label",null,"\u0411\u0440\u043e\u043a\u0435\u0440"),r.a.createElement("input",{value:this.state.broker,onChange:function(t){return e.handleInputChange(t,"broker")}})),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",null,"\u0410\u043a\u043a\u0430\u0443\u043d\u0442"),r.a.createElement("input",{value:this.state.account,onChange:function(t){return e.handleInputChange(t,"account")}}))),s),n&&r.a.createElement("div",null,r.a.createElement("button",{onClick:this.getInstruments},"Get Instruments")),o.map(function(t,n){return r.a.createElement("button",{className:l[t.sym]&&"active",key:n,onClick:function(){return e.handleInstrumentClick({sym:t.sym})}},t.sym)}),r.a.createElement("hr",null),r.a.createElement("div",{className:"body_wrap"},r.a.createElement("div",{className:"trading_wrap"},Object.keys(l).map(function(e){return r.a.createElement("div",{key:e,className:"trading"},r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("b",null,"instrument:")," ",l[e].instrumentId),r.a.createElement("li",null,r.a.createElement("b",null,"bid:")," ",l[e].bid,", ",r.a.createElement("b",null,"ask:")," ",l[e].ask),r.a.createElement("li",null,r.a.createElement("b",null,"time:")," ",l[e].time)))}))))}}]),t}(r.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(r.a.createElement(E,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[40,2,1]]]);
//# sourceMappingURL=main.3ca0b525.chunk.js.map