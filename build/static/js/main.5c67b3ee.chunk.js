(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{20:function(e,t){var n=t.Quote={};n.read=function(e,t){return e.readFields(n._readField,{rec:null,instrumentId:"",bid:"",ask:"",time:0},t)},n._readField=function(e,t,n){1===e?t.rec=r.read(n,n.readVarint()+n.pos):2===e?t.instrumentId=n.readString():3===e?t.bid=n.readString():4===e?t.ask=n.readString():5===e&&(t.time=n.readVarint(!0))},n.write=function(e,t){e.rec&&t.writeMessage(1,r.write,e.rec),e.instrumentId&&t.writeStringField(2,e.instrumentId),e.bid&&t.writeStringField(3,e.bid),e.ask&&t.writeStringField(4,e.ask),e.time&&t.writeVarintField(5,e.time)};var r=t.Recipient={};r.read=function(e,t){return e.readFields(r._readField,{brokerId:0,accountId:0},t)},r._readField=function(e,t,n){1===e?t.brokerId=n.readVarint(!0):2===e&&(t.accountId=n.readVarint(!0))},r.write=function(e,t){e.brokerId&&t.writeVarintField(1,e.brokerId),e.accountId&&t.writeVarintField(2,e.accountId)}},24:function(e,t,n){e.exports=n(39)},29:function(e,t,n){},39:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),c=n(13),o=n.n(c),i=(n(29),n(7)),s=n.n(i),l=n(14),u=n(6),d=n(15),m=n(16),h=n(22),g=n(17),f=n(23),p=function(e){var t=e.sub,n=t.instrumentId,r=t.bid,c=t.ask,o=t.time;return a.a.createElement("div",{className:"trading"},a.a.createElement("ul",null,a.a.createElement("li",null,a.a.createElement("b",null,"instrument:")," ",n),a.a.createElement("li",null,a.a.createElement("b",null,"bid:")," ",r,", ",a.a.createElement("b",null,"ask:")," ",c),a.a.createElement("li",null,a.a.createElement("b",null,"time:")," ",o)))},E=function(e){var t=e.start,n=e.inputChange,r=e.enabled,c=e.perSecond,o=e.seconds;return a.a.createElement("div",{className:"stress"},!r&&a.a.createElement("button",{onClick:t},"Stress"),a.a.createElement("input",{onChange:function(e){return n(e,"perSecond")},value:c,type:"number"})," ","per. sec.",a.a.createElement("input",{onChange:function(e){return n(e,"seconds")},value:o,type:"number"})," ","repeat sec")},k=n(4),v=Object(k.b)(function(e){return{subscriptions:e.market.subscriptions,instruments:e.market.instruments}})(function(e){var t=e.instruments,n=e.subscriptions,r=e.handleClick;return a.a.createElement("div",{className:"instruments"},t.map(function(e,t){return a.a.createElement("button",{className:n[e.sym]&&"active",key:t,onClick:function(){return r(e.sym)}},e.sym)}))}),S=function(e){var t=e.label,n=e.value,r=e.changeHangler;return a.a.createElement("div",{className:"form-group"},a.a.createElement("label",null,t),a.a.createElement("input",{value:n,onChange:r}))},b=n(19),w=n.n(b),I=n(20),C=n(1);function y(e){var t=Object(C.a)({},e);for(var n in t){var r=t[n];"object"===typeof r&&null!==r&&(r=y(r))}return t}var O="USER_CONNECT_START",N="USER_CONNECT_SUCCESS",T="USER_CONNECT_ERROR",j="FETCH_INSTRUMENTS_START",F="FETCH_INSTRUMENTS_SUCCESS",U="SET_SUBSCRIPTIONS";var R={instrumentId:0,bid:0,ask:0,time:0};function _(e,t){return function(n,r){var a=r().socket.socket;n({type:j}),a.send(JSON.stringify({type:2,rec:{b:e,a:t}}))}}function V(e){return{type:U,subscriptions:e}}function x(e){return function(t,n){t({type:O});var r=new WebSocket(e);r.binaryType="arraybuffer",r.onerror=function(e){t(function(e){return{type:T,error:e}}(e))},r.onopen=function(){t(function(e){return{type:N,socket:e}}(r))},r.onmessage=function(e){var r,a,c=n().market.subscriptions,o=null;if("string"!==typeof e.data){var i=new w.a(e.data),s=r=I.Quote.read(i),l=s.instrumentId,u=s.bid,d=s.ask,m=s.time;(o=y(c))[l]||(o[l]={instrumentId:l});var h=o[l];h&&(h.instrumentId=l,h.bid=u,h.ask=d,h.time=m),t(V(o))}else r=JSON.parse(e.data);switch(r.type){case 7:return t((a=r.instruments,{type:F,instruments:a}))}}}}window.limits={perSecond:200,seconds:60};var H=function(e){function t(){var e,n;Object(d.a)(this,t);for(var r=arguments.length,a=new Array(r),c=0;c<r;c++)a[c]=arguments[c];return(n=Object(h.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(a)))).state={storageUrl:localStorage.getItem("storageUrl")||"",userId:localStorage.getItem("userId")||"",broker:localStorage.getItem("broker")||"",account:localStorage.getItem("account")||"",perSecond:localStorage.getItem("perSecond")||10,seconds:localStorage.getItem("seconds")||1,stressEnabled:!1},n.handleInputChange=function(e,t){var r=e.target.value;"perSecond"===t&&r>window.limits.perSecond&&(r=window.limits.perSecond),"seconds"===t&&r>window.limits.seconds&&(r=window.limits.seconds),localStorage.setItem(t,r),n.setState(Object(u.a)({},t,r))},n.handleConnectButtonClick=function(){var e=n.state,t=e.storageUrl,r=e.userId;n.props.initWebSocket(t.split("?")[0]+"?user="+r)},n.request=function(e){n.state.socket.send(e)},n.handleInstrumentClick=function(e){var t=n.state,r=t.broker,a=t.account;n.props.setInstrument(e,r,a)},n.getInstruments=function(){var e=n.state,t=e.broker,r=e.account;n.props.fetchInstruments(t,r)},n.handleStressTest=Object(l.a)(s.a.mark(function e(){var t,r,a,c,o,i,l,u;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=n.state,r=t.seconds,a=t.perSecond,c=n.props.instruments,n.setState({stressEnabled:!0}),o=function(e){return new Promise(function(t,r){n.handleInstrumentClick(e),setTimeout(t,Math.floor(1e3/+a))})},i=0;case 5:if(!(i<+r)){e.next=17;break}l=0;case 7:if(!(l<+a)){e.next=14;break}return u=Math.floor(Math.random()*c.length),e.next=11,o(c[u].sym);case 11:l++,e.next=7;break;case 14:i++,e.next=5;break;case 17:n.setState({stressEnabled:!1});case 18:case"end":return e.stop()}},e,this)})),n}return Object(f.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this,t=this.state,n=t.perSecond,r=t.seconds,c=t.stressEnabled,o=this.props,i=o.authorized,s=o.loading,l=o.instruments,u=o.subscriptions;return a.a.createElement("div",null,a.a.createElement("div",{className:"control"},a.a.createElement(a.a.Fragment,null,a.a.createElement(S,{label:"\u0415\u043d\u0434\u043f\u043e\u0438\u043d\u0442 (ws[s]://...)",value:this.state.storageUrl,changeHangler:function(t){return e.handleInputChange(t,"storageUrl")}}),a.a.createElement(S,{label:"\u042e\u0437\u0435\u0440",value:this.state.userId,changeHangler:function(t){return e.handleInputChange(t,"userId")}})),i&&a.a.createElement("div",null,a.a.createElement(S,{label:"\u0411\u0440\u043e\u043a\u0435\u0440",value:this.state.broker,changeHangler:function(t){return e.handleInputChange(t,"broker")}}),a.a.createElement(S,{label:"\u0410\u043a\u043a\u0430\u0443\u043d\u0442",value:this.state.account,changeHangler:function(t){return e.handleInputChange(t,"account")}})),s?a.a.createElement("span",null,"Loading"):!i&&a.a.createElement("button",{type:"button",onClick:this.handleConnectButtonClick},"Connect")),i&&a.a.createElement("div",null,a.a.createElement("button",{onClick:this.getInstruments},"Get Instruments"),l.length>0?a.a.createElement(E,{enabled:c,inputChange:this.handleInputChange,perSecond:n,seconds:r,start:this.handleStressTest}):null),a.a.createElement(v,{handleClick:this.handleInstrumentClick}),a.a.createElement("hr",null),i&&a.a.createElement("div",{className:"body_wrap"},a.a.createElement("div",{className:"trading_wrap"},a.a.createElement("div",{className:"tr_item"},a.a.createElement("h2",null,"Subscriptions:"),Object.keys(u).map(function(e){return a.a.createElement(p,{key:e,sub:u[e]})})))))}}]),t}(a.a.Component),M=Object(k.b)(function(e){return{loading:e.socket.loading,authorized:e.socket.authorized,instruments:e.market.instruments,subscriptions:e.market.subscriptions}},function(e){return{initWebSocket:function(t){return e(x(t))},fetchInstruments:function(t,n){return e(_(t,n))},setInstrument:function(t,n,r){return e(function(e,t,n){return function(r,a){var c,o=a(),i=o.market.subscriptions,s=o.socket.socket,l=y(i),u=[];l[e]?delete l[e]:(l[e]=Object(C.a)({},R),l[e].instrumentId=e),Object.keys(l).forEach(function(e){return u.push(e)}),r(V(l)),c=function(e){for(var t=5381,n=e.length;n;)t=33*t^e.charCodeAt(--n);return t>>>0}(t+"&"+n+"&"+u),s.send(JSON.stringify({type:1,s:{rec:{b:t,a:n},sym:u,hash:c}}))}}(t,n,r))}}})(H);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var z=n(2),B=n(21),J={authorized:!1,loading:!1,socket:null,error:null},W={loading:!1,instruments:[],subscriptions:{}},A=Object(z.c)({socket:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:J,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case O:return Object(C.a)({},e,{loading:!0});case N:return Object(C.a)({},e,{loading:!1,authorized:!0,socket:t.socket});case T:return Object(C.a)({},e,{loading:!1,error:t.error});default:return e}},market:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:W,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case U:return Object(C.a)({},e,{subscriptions:t.subscriptions});case j:return Object(C.a)({},e,{loading:!0});case F:return Object(C.a)({},e,{instruments:t.instruments,loading:!1});default:return e}}}),P=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||z.d,D=Object(z.e)(A,P(Object(z.a)(B.a)));o.a.render(a.a.createElement(k.a,{store:D},a.a.createElement(M,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[24,2,1]]]);
//# sourceMappingURL=main.5c67b3ee.chunk.js.map