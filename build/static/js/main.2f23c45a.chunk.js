(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{41:function(e,t,n){e.exports=n(68)},46:function(e,t,n){},68:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),r=n(33),c=n.n(r),s=(n(46),n(20)),u=n.n(s),l=n(34),i=n(9),d=n(5),m=n(11),b=n(35),f=n(36),p=n(39),g=n(37),h=n(40),k=n(38),v=n.n(k),y=function(e){function t(){var e,n;Object(b.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(p.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(o)))).state={storageUrl:localStorage.getItem("storageUrl")||"",userId:localStorage.getItem("userId")||"",broker:localStorage.getItem("broker")||"",account:localStorage.getItem("account")||"",authorized:!1,loading:!1,socket:null,consoleData:[],protoQuotes:null},n.handleInputChange=function(e,t){var a=e.target.value;localStorage.setItem(t,a),n.setState(Object(m.a)({},t,a))},n.handleConnectButtonClick=function(){var e=n.state,t=e.authorized,a=e.storageUrl,o=e.userId,r=n.state.socket;if(t)r&&t&&(n.setState({instruments:[],activeInstrument:null}),r.close());else{try{(r=new WebSocket(a.split("?")[0]+"?user="+o)).binaryType="arraybuffer"}catch(c){return n.setState({consoleData:[c.message]})}n.setState({socket:r,loading:!0})}},n.initWebSocket=function(){var e=n.state.socket;e.onopen=function(){n.setState(function(e){return Object(d.a)({},e,{consoleData:[].concat(Object(i.a)(e.consoleData),["\u0421\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043e."])})}),n.request(JSON.stringify({user:{userId:666}}))},e.onclose=function(e){var t="";t=e.wasClean?"\u0421\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u0437\u0430\u043a\u0440\u044b\u0442\u043e":"\u041e\u0431\u0440\u044b\u0432 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f",n.setState(function(e){return Object(d.a)({},e,{consoleData:[].concat(Object(i.a)(e.consoleData),[t]),authorized:!1,socket:null,loading:!1,order:null})})},e.onmessage=function(){var t=Object(l.a)(u.a.mark(function t(a){var o,r,c,s,l,i;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=n.state,c=r.authorized,s=r.protoQuotes,"string"!==typeof a.data?(console.time("Buff"),l=new Uint8Array(a.data),o=s.decode(l)):o=JSON.parse(a.data),i=o.type,t.t0=i,t.next=0===t.t0?6:1===t.t0?8:10;break;case 6:return c=!0,t.abrupt("break",11);case 8:return c=!1,t.abrupt("break",11);case 10:return t.abrupt("break",11);case 11:c||(e=null),n.setState(function(t){return Object(d.a)({},t,{consoleData:[JSON.stringify(o)],authorized:c,loading:!1,socket:e})});case 13:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),e.onerror=function(e){n.setState(function(t){return Object(d.a)({},t,{consoleData:[].concat(Object(i.a)(t.consoleData),["\u041e\u0448\u0438\u0431\u043a\u0430 "+e.message]),authorized:!1,socket:null,loading:!1})})}},n.request=function(e){n.state.socket.send(e),n.setState(function(t){return Object(d.a)({},t,{consoleData:[].concat(Object(i.a)(t.consoleData),["request ->   "+e])})})},n.subscribe=function(e){var t=e.brokerId;"default"===t&&(t=666),n.request(JSON.stringify({type:1,sub:[{rec:{brk:t,acc:666},sym:["EURUSD","USDJPY"]}]}))},n.unsubscribe=function(e){var t=e.brokerId;"default"===t&&(t=666),n.request(JSON.stringify({type:1,sub:[{rec:{brk:t,acc:666},sym:[]}]}))},n.getInstruments=function(){var e=n.state,t=e.broker,a=e.account;e.socket.send(JSON.stringify({type:2,rec:{brk:t,acc:a}}))},n}return Object(h.a)(t,e),Object(f.a)(t,[{key:"componentDidUpdate",value:function(e,t){console.timeEnd("Buff"),!t.socket&&this.state.socket&&this.initWebSocket()}},{key:"componentDidMount",value:function(){var e=this;v.a.load("proto/awesome.proto").then(function(t){var n=t.lookupType("protobuf.quotes.Quote");e.setState(function(e){return Object(d.a)({},e,{protoQuotes:n})})})}},{key:"render",value:function(){var e=this,t=this.state,n=t.authorized,a=t.consoleData,r=t.loading?o.a.createElement("span",null,"Loading"):o.a.createElement("button",{type:"button",onClick:this.handleConnectButtonClick},n?"Disconnect":"Connect");return o.a.createElement("div",null,o.a.createElement("div",{className:"control"},o.a.createElement("div",null,o.a.createElement("div",{className:"form-group"},o.a.createElement("label",null,"\u0415\u043d\u0434\u043f\u043e\u0438\u043d\u0442 (ws[s]://...)"),o.a.createElement("input",{value:this.state.storageUrl,onChange:function(t){return e.handleInputChange(t,"storageUrl")}})),o.a.createElement("div",{className:"form-group"},o.a.createElement("label",null,"\u042e\u0437\u0435\u0440"),o.a.createElement("input",{value:this.state.userId,onChange:function(t){return e.handleInputChange(t,"userId")}}))),n&&o.a.createElement("div",null,o.a.createElement("div",{className:"form-group"},o.a.createElement("label",null,"\u0411\u0440\u043e\u043a\u0435\u0440"),o.a.createElement("input",{value:this.state.broker,onChange:function(t){return e.handleInputChange(t,"broker")}})),o.a.createElement("div",{className:"form-group"},o.a.createElement("label",null,"\u0410\u043a\u043a\u0430\u0443\u043d\u0442"),o.a.createElement("input",{value:this.state.account,onChange:function(t){return e.handleInputChange(t,"account")}}))),r),n&&o.a.createElement("div",null,o.a.createElement("button",{onClick:this.getInstruments},"Get Instruments"),o.a.createElement("button",{onClick:function(){return e.subscribe({brokerId:"default"})}},"Subscribe")),a.length?o.a.createElement("div",{className:"console-wrap"},o.a.createElement("button",{onClick:function(){return e.setState({consoleData:[]})}},"Clear"),a.map(function(e,t){return o.a.createElement("p",{className:"console",key:t},e)})):null)}}]),t}(o.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(o.a.createElement(y,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[41,2,1]]]);
//# sourceMappingURL=main.2f23c45a.chunk.js.map